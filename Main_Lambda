import requests
import os
import openai
from dotenv import load_dotenv


# Load the environment variables from the .env file
load_dotenv()


# Set the OpenAI API key from the environment variable
openai.api_key = os.getenv("OPENAI_API_KEY")


def get_ticket_subject(ticket_number):
    # Create a session and authenticate with basic auth
    session = requests.Session()
    session.headers = {
        'Authorization': os.getenv("Zendesk_Auth")
    }


    # Make a GET request to retrieve the ticket details
    response = session.get(f'http://centralsupportdesk1657134016.zendesk.com/api/v2/tickets/{ticket_number}.json')


    # Check if the request was successful
    if response.status_code == 200:
        # Extract the subject from the response JSON
        ticket_data = response.json()
        subject = ticket_data['ticket']['subject']
        print(subject)


    # Improve Subject Text Using Open AI
        completion = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
            {"role": "user", "content": f"Print the improved version of the following headline: '{subject}'"}
            ]
        )


        print(completion.choices[0].message)


# Replace '123' with the actual ticket number you want to retrieve the subject for
get_ticket_subject(1655)
